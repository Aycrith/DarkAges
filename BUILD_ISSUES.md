# DarkAges Build Issues & Fixes

**Generated**: 2026-01-29  
**Status**: Analysis Complete, Fixes Required

---

## Summary

| Category | Count | Priority |
|----------|-------|----------|
| Missing Dependencies | 1 | CRITICAL |
| Missing #include | 171 | HIGH |
| Missing Library (GLM) | 1 | MEDIUM |

---

## CRITICAL: Missing EnTT Submodule

### Problem
The EnTT ECS library is referenced but not present:
```
Error: deps/entt/single_include/entt/entt.hpp not found
```

### Fix
```bash
# Option 1: Add as git submodule
git submodule add https://github.com/skypjack/entt.git deps/entt
git submodule update --init

# Option 2: Manual clone
git clone https://github.com/skypjack/entt.git deps/entt
cd deps/entt
git checkout v3.13.0
```

### CMakeLists.txt Already Handles This
The CMakeLists.txt will use FetchContent if the submodule is not found, but having it locally is faster.

---

## HIGH: Missing #include Directives

### Statistics
- **Total files affected**: 70 files
- **Most common missing headers**:
  - `<cstdint>`: 50+ files (for uint32_t, uint64_t)
  - `<vector>`: 30+ files
  - `<memory>`: 15+ files
  - `<chrono>`: 10+ files
  - `<mutex>`: 10+ files
  - `<cmath>`: 8+ files

### Automated Fix Available
Run the fix script:
```bash
python tools/build/fix_includes.py
```

This will automatically add missing `#include` directives to all affected files.

### Manual Fix (if preferred)
Add these to the top of each affected .cpp file after the existing includes:
```cpp
#include <cstdint>   // For uint32_t, uint64_t, etc.
#include <vector>    // For std::vector
#include <memory>    // For std::unique_ptr, std::make_unique
#include <chrono>    // For std::chrono
#include <mutex>     // For std::mutex
#include <cmath>     // For std::sqrt, std::abs
```

---

## MEDIUM: GLM Dependency

### Problem
20 files use GLM (OpenGL Mathematics) for vector math:
- `src/server/include/ecs/CoreTypes.hpp` uses `glm::vec3`

### Fix
Add to CMakeLists.txt:
```cmake
FetchContent_Declare(
    glm
    GIT_REPOSITORY https://github.com/g-truc/glm.git
    GIT_TAG 0.9.9.8
)
FetchContent_MakeAvailable(glm)
```

Or use local copy:
```bash
git clone https://github.com/g-truc/glm.git deps/glm
```

---

## Files Requiring Most Fixes

| File | Missing Headers |
|------|-----------------|
| `src/server/src/db/RedisManager.cpp` | 7 headers |
| `src/server/src/db/ScyllaManager.cpp` | 6 headers |
| `src/server/src/zones/ZoneOrchestrator.cpp` | 5 headers |
| `src/server/tests/TestDDoSProtection.cpp` | 3 headers |
| `src/server/tests/TestDeltaCompression.cpp` | 4 headers |

---

## Step-by-Step Fix Procedure

### Step 1: Get EnTT (CRITICAL)
```bash
git clone https://github.com/skypjack/entt.git deps/entt
cd deps/entt && git checkout v3.13.0 && cd ../..
```

### Step 2: Get GLM (MEDIUM)
```bash
git clone https://github.com/g-truc/glm.git deps/glm
```

### Step 3: Fix Missing Includes (HIGH)
```bash
python tools/build/fix_includes.py
```

### Step 4: Verify Build
```bash
mkdir build && cd build
cmake .. -DBUILD_TESTS=ON
cmake --build . --parallel
```

### Step 5: Run Tests
```bash
ctest --output-on-failure
```

---

## Pre-Fixed Test Status

Before running fixes:
```
Expected: Build will fail
- EnTT not found
- Multiple undefined type errors
- Missing standard library symbols
```

After running fixes:
```
Expected: Build should succeed
- All dependencies resolved
- All includes present
- Tests compile and run
```

---

## Verification Commands

```bash
# Check EnTT
ls deps/entt/single_include/entt/entt.hpp

# Check GLM
ls deps/glm/glm/glm.hpp

# Run analysis
python tools/build/analyze_code.py

# Fix includes
python tools/build/fix_includes.py

# Build
./build.ps1 -Test  # Windows
# or
./build.sh -t      # Linux
```

---

## Next Steps

1. **Immediate** (Today): Run the fix commands above
2. **This Week**: Verify build on Windows and Linux
3. **Next Week**: Expand test coverage

---

*This file is generated by `tools/build/analyze_code.py`. Re-run to update.*
